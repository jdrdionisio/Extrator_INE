# Check if a data frame for this indicator already exists
if (!(indicador %in% names(df_list))) {
# If not, create a new data frame for this indicator
df_list[[indicador]] <- df
} else {
# If it does, use rbind to combine the data frames
df_list[[indicador]] <- rbind(df_list[[indicador]], df)
}
}
View(df_list)
file_names <- list.files(path = "outputs", pattern = ".*\\.csv")
# Initialize a list to store the data frames
df_list <- list()
#FOR LOOP
for (file_name in file_names) {
# Split the file name into its components
components <- strsplit(file_name, "_")[[1]]
# Assign the components to variables
indicador <- components[1]
year <- components[2]
aggregation <- components[3]
# Load the file into a data frame
df <- read.csv(file.path("outputs", file_name))
# Add columns for year and aggregation
df <- cbind(df, year = year, aggregation = aggregation)
# Check if a data frame for this indicator already exists
if (!(indicador %in% names(df_list))) {
# If not, create a new data frame for this indicator
df_list[[indicador]] <- df
} else {
# If it does, use rbind to combine the data frames
df_list[[indicador]] <- rbind(df_list[[indicador]], df)
}
}
View(df_list)
components
# Split the file name into its components
components <- strsplit(file_name, c("_",".")[[1]]
# Assign the components to variables
indicador <- components[1]
for (file_name in file_names) {
# Split the file name into its components
components <- strsplit(file_name, c("_",".")[[1]]
components
for (file_name in file_names) {
# Split the file name into its components
components <- strsplit(file_name, c("_",".")[[1]])
components
for (file_name in file_names) {
# Split the file name into its components
components <- strsplit(file_name, c("_",".")[[1]])
# Assign the components to variables
indicador <- components[1]
year <- components[2]
aggregation <- components[3]
# Load the file into a data frame
df <- read.csv(file.path("outputs", file_name))
# Add columns for year and aggregation
df <- cbind(df, year = year, aggregation = aggregation)
# Check if a data frame for this indicator already exists
if (!(indicador %in% names(df_list))) {
# If not, create a new data frame for this indicator
df_list[[indicador]] <- df
} else {
# If it does, use rbind to combine the data frames
df_list[[indicador]] <- rbind(df_list[[indicador]], df)
}
}
components
for (file_name in file_names) {
# Split the file name into its components
components <- strsplit(file_name, c("_","."))[[1]]
# Assign the components to variables
indicador <- components[1]
year <- components[2]
aggregation <- components[3]
# Load the file into a data frame
df <- read.csv(file.path("outputs", file_name))
# Add columns for year and aggregation
df <- cbind(df, year = year, aggregation = aggregation)
# Check if a data frame for this indicator already exists
if (!(indicador %in% names(df_list))) {
# If not, create a new data frame for this indicator
df_list[[indicador]] <- df
} else {
# If it does, use rbind to combine the data frames
df_list[[indicador]] <- rbind(df_list[[indicador]], df)
}
}
components
df_list <- list()
#FOR LOOP
for (file_name in file_names) {
# Split the file name into its components
components <- strsplit(file_name, c("_"))[[1]]
# Remove the ".csv" extension from the last component
last_component <- sub(".csv", "", components[length(components)])
# Replace the last component in the components vector
components[length(components)] <- last_component
# Assign the components to variables
indicador <- components[1]
year <- components[2]
aggregation <- components[3]
# Load the file into a data frame
df <- read.csv(file.path("outputs", file_name))
# Add columns for year and aggregation
df <- cbind(df, year = year, aggregation = aggregation)
# Check if a data frame for this indicator already exists
if (!(indicador %in% names(df_list))) {
# If not, create a new data frame for this indicator
df_list[[indicador]] <- df
} else {
# If it does, use rbind to combine the data frames
df_list[[indicador]] <- rbind(df_list[[indicador]], df)
}
}
components
components[length(components)
# Replace the last component in the components vector
components[length(components)] <- last_component
components[length(components)]
# Remove the ".csv" extension from the last component
last_component <- sub(".csv", "", components[length(components)])
last_component
# Replace the last component in the components vector
components[length(components)] <- last_component
components
file_names <- list.files(path = "outputs", pattern = ".*\\.csv")
# Initialize a list to store the data frames
df_list <- list()
#FOR LOOP
for (file_name in file_names) {
# Split the file name into its components
components <- strsplit(file_name, c("_"))[[1]]
# Remove the ".csv" extension from the last component
last_component <- sub(".csv", "", components[length(components)])
components[length(components)]
# Replace the last component in the components vector
components[length(components)] <- last_component
# Assign the components to variables
indicador <- components[1]
year <- components[2]
aggregation <- components[3]
# Load the file into a data frame
df <- read.csv(file.path("outputs", file_name))
# Add columns for year and aggregation
df <- cbind(df, year = year, aggregation = aggregation)
# Check if a data frame for this indicator already exists
if (!(indicador %in% names(df_list))) {
# If not, create a new data frame for this indicator
df_list[[indicador]] <- df
} else {
# If it does, use rbind to combine the data frames
df_list[[indicador]] <- rbind(df_list[[indicador]], df)
}
}
unnest(df_list)
unnest(df_list, cols = c(`0008614`, `0009817`))
unnest(df_list, .cols = c(`0008614`, `0009817`))
df_list$0008614
df_list[0008614]
View(df_list)
df_list[["0008614"]]
lapply(df_list, function(df) {
write.csv(df, file.path("outputs", paste0(names(df), ".csv")))
})
lapply(df_list, function(df)){
lapply(df_list, function(df){
write.csv(df, file.path("outputs", paste0(names(df), ".csv")))
})
View(df_list)
map(df_list, ~ write.csv(.x, file.path("outputs", paste0(.y, ".csv"))))
map(df_list,write.csv(.x, file.path("outputs", paste0(.y, ".csv"))))
map(df_list~write.csv(.x, file.path("outputs", paste0(.y, ".csv"))))
for (df_name in names(df_list)) {
df <- df_list[[df_name]]
write.csv(df, file.path("outputs", paste0(df_name, ".csv")))
}
install.packages("shiny", dependencies=TRUE)
library("shiny")
#TOTAL DE INDICADORES
Indicadores <- read_excel("datasets/Indicadores.xlsx", skip = 14)
install.packages('jsonlite', dependencies=TRUE, repos='http://cran.rstudio.com/')
library(jsonlite)
install.packages("tidyverse", dependencies=TRUE, repos='http://cran.rstudio.com/')
library(tidyverse)
install.packages("readxl", dependencies=TRUE, repos='http://cran.rstudio.com/')
library(readxl)
install.packages("data.table", dependencies=TRUE)
install.packages("readxl", dependencies = TRUE, repos = "http://cran.rstudio.com/")
library("data.table")
install.packages("shiny", dependencies=TRUE)
library("shiny")
install.packages("shiny", dependencies = TRUE)
#TOTAL DE INDICADORES
Indicadores <- read_excel("datasets/Indicadores.xlsx", skip = 14)
Indicadores <- Indicadores %>%
filter(`Disponível no Portal`== "Sim")
library(shiny)
ui <- fluidPage(
# App title ----
titlePanel("Downloading Data"),
# Sidebar layout with input and output definitions ----
sidebarLayout(
# Sidebar panel for inputs ----
sidebarPanel(
# Input: Choose dataset ----
selectInput("dataset", "Choose a dataset:",
choices = Indicadores$`Código de difusão`),
# Input: Choose dataset ----
selectInput("Número de Observações", "Choose a number:",
choices = seq(2:25)),
# Button
downloadButton("downloadData", "Download")
),
# Main panel for displaying outputs ----
mainPanel(
tableOutput("table")
)
)
)
install.packages("data.table")
library("data.table")
install.packages("data.table")
runApp('INE_API')
runApp('INE_API')
runApp('INE_API')
View(ui)
linkage_geo <- read_csv("datasets/linkage_geo.csv")
linkage_geo <- linkage_geo %>%
select(geo, ars, nuts3, aces2, nuts1, nuts2, cod_geo_nuts2002, cod_geo)  %>%
rename(municip="geo")%>%
mutate(municip= recode(municip, "Calheta"="Calheta [R.A. Madeira]"))
selected_row <- Indicadores[Indicadores$Designação == input$dataset,]
#install.packages('jsonlite', dependencies=TRUE, repos='http://cran.rstudio.com/')
library(jsonlite)
#install.packages("tidyverse", dependencies=TRUE, repos='http://cran.rstudio.com/')
library(tidyverse)
# install.packages("readxl", dependencies=TRUE, repos='http://cran.rstudio.com/')
library(readxl)
# install.packages("data.table")
library(data.table)
# install.packages("shiny")
library(shiny)
pop_2013 <- read_csv("outputs/pop_2013.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
# filter()
# left_join(linkage_geo,by = "last_4")
pop_2014 <- read_csv("outputs/pop_2014.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))
pop_2013 <- read_csv("outputs/pop_2013.csv")
View(pop_2013)
pop_2013 <- read_csv("outputs/pop_2013.csv")%>%
filter(dim_3!="HM")
View(pop_2013)
linkage_geo <- read_csv("datasets/linkage_geo.csv")%>%
mutate(last_4 = as.character(substr(cod_geo, nchar(cod_geo)-3,nchar(cod_geo))))
linkage_geo_freg <- read_csv2("datasets/categorias_geo_freg.csv")%>%
select(-municip)%>%
rename(last_4 =pair)%>%
left_join(linkage_geo,by = "last_4")
linkage_geo <- linkage_geo %>%
select(geo, ars, nuts3, aces2, nuts1, nuts2, cod_geo_nuts2002, cod_geo)%>%
rename(municip="geo")%>%
mutate(municip= recode(municip, "Calheta"="Calheta [R.A. Madeira]"))%>%
rename(geocod = "cod_geo")
View(linkage_geo)
View(pop_2013)
View(pop_2013)
pop_2013 <- read_csv("outputs/pop_2013.csv")%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))
left_join(linkage_geo, join_by(municip==municip))
pop_2013 <- read_csv("outputs/pop_2013.csv")%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
View(pop_2013)
pop_2013 <- read_csv("outputs/pop_2013.csv")%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2014 <- read_csv("outputs/pop_2014.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2015 <- read_csv("outputs/pop_2015.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2016 <- read_csv("outputs/pop_2016.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2017 <- read_csv("outputs/pop_2017.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2018 <- read_csv("outputs/pop_2018.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2019 <- read_csv("outputs/pop_2019.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2020 <- read_csv("outputs/pop_2020.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2021 <- read_csv("outputs/pop_2021.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
fwrite(pop_2013,file = paste0("datasets/pop_2013.csv"), bom = T)
fwrite(pop_2014,file = paste0("datasets/pop_2014.csv"), bom = T)
fwrite(pop_2015,file = paste0("datasets/pop_2015.csv"), bom = T)
fwrite(pop_2016,file = paste0("datasets/pop_2016.csv"), bom = T)
fwrite(pop_2017,file = paste0("datasets/pop_2017.csv"), bom = T)
fwrite(pop_2018,file = paste0("datasets/pop_2018.csv"), bom = T)
fwrite(pop_2019,file = paste0("datasets/pop_2019.csv"), bom = T)
fwrite(pop_2020,file = paste0("datasets/pop_2020.csv"), bom = T)
fwrite(pop_2021,file = paste0("datasets/pop_2021.csv"), bom = T)
pop_2013 <- read_csv("outputs/pop_2013.csv")%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="3003101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="2004501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
geocod=="2004201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2014 <- read_csv("outputs/pop_2014.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="3003101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="2004501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
geocod=="2004201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2015 <- read_csv("outputs/pop_2015.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="3003101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="2004501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
geocod=="2004201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2016 <- read_csv("outputs/pop_2016.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="3003101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="2004501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
geocod=="2004201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2017 <- read_csv("outputs/pop_2017.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="3003101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="2004501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
geocod=="2004201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2018 <- read_csv("outputs/pop_2018.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="3003101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="2004501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
geocod=="2004201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2019 <- read_csv("outputs/pop_2019.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="3003101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="2004501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
geocod=="2004201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2020 <- read_csv("outputs/pop_2020.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="3003101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="2004501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
geocod=="2004201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
pop_2021 <- read_csv("outputs/pop_2021.csv",
col_types = cols(dim_4 = col_number(),
valor = col_number()))%>%
filter(dim_3_t!="HM")%>%
mutate(municip = case_when(
geocod=="1113101" ~ "Calheta [R.A. Madeira]",
geocod=="3003101" ~ "Calheta [R.A. Madeira]",
geocod=="1114501" ~ "Calheta [R.A. Açores]",
geocod=="2004501" ~ "Calheta [R.A. Açores]",
geocod=="1114201" ~ "Lagoa [R.A. Açores]",
geocod=="2004201" ~ "Lagoa [R.A. Açores]",
TRUE ~ as.character(geodsg)))%>%
left_join(linkage_geo, join_by(municip==municip))
fwrite(pop_2013,file = paste0("datasets/pop_2013.csv"), bom = T)
fwrite(pop_2013,file = paste0("datasets/pop_2013.csv"), bom = T)
fwrite(pop_2014,file = paste0("datasets/pop_2014.csv"), bom = T)
fwrite(pop_2015,file = paste0("datasets/pop_2015.csv"), bom = T)
fwrite(pop_2016,file = paste0("datasets/pop_2016.csv"), bom = T)
fwrite(pop_2017,file = paste0("datasets/pop_2017.csv"), bom = T)
fwrite(pop_2018,file = paste0("datasets/pop_2018.csv"), bom = T)
fwrite(pop_2019,file = paste0("datasets/pop_2019.csv"), bom = T)
fwrite(pop_2020,file = paste0("datasets/pop_2020.csv"), bom = T)
fwrite(pop_2021,file = paste0("datasets/pop_2021.csv"), bom = T)
?render
??render
